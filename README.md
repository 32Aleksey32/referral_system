# Referral System API

### Описание проекта:
Проект представляет собой реферальную систему с использованием FastAPI и PostgreSQL.
В рамках проекта реализованы следующие функции:
- Регистрация и аутентификация пользователей (JWT, OAuth 2.0)
- Получение информации о текущем пользователе
- Создание и удаление реферального кода пользователем
- Регистрация по реферальному коду
- Получение информации о рефералах
- Валидация email с использованием Hunter.io (не проверяет email с доменом .ru)


## Настройка проекта
Для работы проекта необходимо создать файл `.env` в корневом каталоге проекта и задать следующие переменные окружения:

- `DATABASE_URL=<URL для подключения к базе данных Postgres>`. По умолчанию: `postgresql+asyncpg://postgres:postgres@db:5432/referral_system`
- `SECRET_KEY=<Секретный ключ для подписывания JWT токенов>`. По умолчанию: `secret-key`
- `ALGORITHM=<HS256>`. По умолчанию: `HS256`
- `ACCESS_TOKEN_EXPIRE_MINUTES=<Время жизни токена (в минутах)>`. По умолчанию: `30`
- `HUNTER_API_KEY=<Ваш API ключ для проверки email через hunter.io>`. Получить можно [здесь](https://hunter.io/api-keys)

Большинство переменных окружения уже имеют значения по умолчанию, которые находятся в файле `settings.py`.  
Однако для работы с API сервиса [Hunter.io](https://hunter.io) необходимо обязательно задать переменную `HUNTER_API_KEY`.  
Для запуска проекта локально в `DATABASE_URL` вместо `db` должно быть `localhost`.


## Установка и запуск проекта при помощи Docker

1. **Клонируйте репозиторий на свой компьютер.**
```bash
git clone https://github.com/32Aleksey32/referral_system.git
```
2. **Перейдите в папку с проектом.**
```
cd referral_system/
```
3. **Запустите процесс создания и запуск контейнеров.**
```
docker-compose up --build
```
4. **Перейдите по адресу**
```
http://127.0.0.1:8000/docs
```

## Установка и запуск проекта локально

1. **Клонируйте репозиторий на свой компьютер.**
```sh
git clone https://github.com/32Aleksey32/referral_system.git
```
2. **Перейдите в папку с проектом.**
```
cd referral_system/
```
3. **Установите и активируйте виртуальное окружение**
```sh
python -m venv env
source env/bin/activate
```
4. **Установите зависимости**
```
pip install -r requirements.txt
```
5. **Примените миграции**
```
alembic upgrade head
```
6. **Запустите проект**
```
uvicorn app.main:app --reload
```
7. **Перейдите по адресу**
```
http://127.0.0.1:8000/docs
```


## Основные эндпоинты
- **`POST /users/register`** - Регистрация нового пользователя
- **`POST /users/login`** - Аутентификация пользователя
- **`GET /users/me`** - Информация о текущем пользователе
- **`POST /referral-codes`** - Создание реферального кода
- **`DELETE /referral-codes`** - Удаление реферального кода
- **`GET /referral-codes/{email}`** - Получение реферального кода по email
- **`GET /referrals/{user_id}`** - Получение информации о рефералах


## Стек технологий
- Python 3.10
- FastAPI
- PostgreSQL
- SQLAlchemy
- Alembic
- Docker & Docker Compose
- Pydantic
- Asyncio
